# 智能思维导图生成功能说明

## 功能概述

现在你的 AI 助手具备了**智能生成思维导图**的能力！当用户只提供一个主题（如"红楼梦"）时，AI 会自动：

1. 📡 **联网搜索**相关资料
2. 📝 **整理信息**为结构化内容
3. 🎨 **生成思维导图** JSON

## 工作流程

```
用户输入
  ↓
"生成红楼梦的思维导图"
  ↓
AI 判断需要搜索
  ↓
调用 web_search 工具
  ↓
搜索"红楼梦 主要内容 知识点"
  ↓
收集并整理搜索结果
  ↓
调用 generate_mind_map 工具
  ↓
传入整理的文本内容
  ↓
返回完整的思维导图 JSON
```

## 使用示例

### 示例 1：主题式生成（会自动搜索）

**用户输入：**
```
给我生成一个有关于红楼梦的思维导图
```

**AI 执行流程：**
```
1. AI 检测到用户只提供了主题"红楼梦"
2. AI 调用：web_search(query="红楼梦 主要内容 知识点", max_results=5)
3. AI 获取搜索结果：
   - 红楼梦简介
   - 主要人物
   - 故事梗概
   - 文学价值
   - 等等...
4. AI 整理搜索结果为连贯文本
5. AI 调用：generate_mind_map(text="红楼梦是清代作家曹雪芹创作的章回体长篇小说，主要讲述...")
6. 返回思维导图 JSON
```

**AI 回复：**
```
我已经为您生成了关于红楼梦的思维导图！

导图包含以下主要内容：
- 作品概述：作者、创作背景、文学地位
- 主要人物：贾宝玉、林黛玉、薛宝钗等
- 故事情节：主要章回和情节发展
- 艺术特色：文学手法、叙事结构
- 文化影响：研究价值、社会影响

[返回完整的思维导图 JSON]
```

### 示例 2：其他主题

**用户输入：**
```
帮我做一个人工智能的思维导图
```

**AI 工作流程：**
1. 搜索"人工智能 知识点 概述"
2. 整理结果（机器学习、深度学习、应用领域等）
3. 生成思维导图

---

**用户输入：**
```
生成一个Go语言学习路线的导图
```

**AI 工作流程：**
1. 搜索"Go语言 学习路线 知识点"
2. 整理结果（基础语法、并发编程、Web开发等）
3. 生成思维导图

### 示例 3：详细内容生成（不会搜索）

**用户输入：**
```
用以下内容生成思维导图：
Go语言是由Google开发的编程语言，具有简洁的语法、高效的并发支持...
[用户提供详细内容]
```

**AI 执行流程：**
```
1. AI 检测到用户已提供详细内容
2. 跳过搜索步骤
3. 直接调用：generate_mind_map(text="用户提供的内容")
4. 返回思维导图 JSON
```

## 已注册的工具

### 1. web_search - 网络搜索工具

**功能**：在互联网上搜索信息

**参数**：
- `query` (必填): 搜索关键词
- `max_results` (可选): 返回结果数量，默认5条

**使用场景**：
- 用户只提供主题，没有详细内容
- 需要最新信息或网络资料

### 2. generate_mind_map - 生成思维导图工具

**功能**：根据文本内容生成思维导图JSON

**参数**：
- `text` (必填): 用于生成导图的文本内容

**使用场景**：
- 用户要求生成新的思维导图
- 已有文本内容（用户提供或搜索获得）

### 3. update_mind_map - 修改思维导图工具

**功能**：修改已存在的思维导图

**参数**：
- `requirement` (必填): 修改需求描述

**使用场景**：
- 用户要求修改当前导图
- 需要调整现有导图结构或内容

## AI 决策逻辑

AI 会根据用户输入自动判断工作流程：

```python
if 用户要求生成思维导图:
    if 用户只提供了主题词（如"红楼梦"）:
        # 场景1：主题式生成
        搜索结果 = web_search(主题 + "知识点")
        整理的文本 = 整理搜索结果()
        导图JSON = generate_mind_map(整理的文本)
        返回导图JSON
    elif 用户提供了详细内容:
        # 场景2：内容式生成
        导图JSON = generate_mind_map(用户提供的内容)
        返回导图JSON
    
elif 用户要求修改导图:
    # 场景3：修改现有导图
    新导图JSON = update_mind_map(修改需求)
    返回新导图JSON
    
else:
    # 场景4：普通对话
    正常回答用户问题()
```

## 配置说明

### 搜索服务配置

在 `conf/config.yaml` 中：

```yaml
search:
  provider: "serpapi"      # 或 "duckduckgo"
  api_key: "your_api_key"  # SerpAPI 需要，DuckDuckGo 不需要
```

你已经配置了 SerpAPI，可以获得更好的搜索结果质量。

### System Prompt 配置

已在配置文件中更新，包含：
- 工具使用指南
- 生成导图的标准流程
- 各个工具的使用场景

## 测试验证

### 测试1：主题式生成（会联网搜索）

向 AI 发送：
```json
{
  "message": "给我生成一个有关于红楼梦的思维导图"
}
```

**预期行为**：
1. AI 调用 `web_search` 搜索红楼梦相关资料
2. AI 整理搜索结果
3. AI 调用 `generate_mind_map` 生成导图
4. 返回完整的思维导图 JSON

### 测试2：内容式生成（不会搜索）

向 AI 发送：
```json
{
  "message": "用以下内容生成思维导图：Go语言是一门现代化的编程语言，具有简洁的语法..."
}
```

**预期行为**：
1. AI 直接调用 `generate_mind_map` 生成导图
2. 返回完整的思维导图 JSON

## 日志监控

生成过程中会输出以下日志：

```
[INFO] 开始网络搜索: query=红楼梦 主要内容 知识点, maxResults=5
[INFO] 网络搜索完成，返回 5 条结果
[INFO] 开始生成思维导图，文本长度: 458, userID: user_123
[INFO] 思维导图生成成功
```

## 优势特点

✅ **智能判断**：AI 自动识别是否需要搜索  
✅ **联网能力**：获取最新、最全面的信息  
✅ **自动整合**：将搜索结果整理成结构化内容  
✅ **质量保证**：基于真实资料生成的导图更准确  
✅ **灵活应用**：适用于各种主题和领域  

## 适用场景

### 教育学习
- "生成唐诗宋词的思维导图"
- "帮我做一个中国历史朝代的导图"
- "生成数学微积分的知识导图"

### 技术学习
- "生成Python编程的思维导图"
- "帮我做一个云计算架构的导图"
- "生成机器学习算法的导图"

### 工作规划
- "生成项目管理流程的思维导图"
- "帮我做一个市场营销策略的导图"
- "生成产品设计思路的导图"

### 兴趣爱好
- "生成电影剪辑技巧的思维导图"
- "帮我做一个旅游攻略的导图"
- "生成健身训练计划的导图"

## 注意事项

1. **搜索结果质量**：取决于搜索引擎返回的内容
2. **内容准确性**：AI 会整理搜索结果，但不保证100%准确
3. **生成时间**：包含搜索步骤，可能需要5-10秒
4. **网络依赖**：需要稳定的网络连接

## 故障排查

### 问题1：AI 没有调用搜索工具

**可能原因**：
- 用户输入不够明确
- AI 判断不需要搜索

**解决方法**：
- 明确要求："搜索一下红楼梦，然后生成思维导图"
- 或使用主题式提问："生成XX的思维导图"

### 问题2：搜索失败

**可能原因**：
- 网络问题
- API Key 无效（SerpAPI）
- 搜索服务限流

**解决方法**：
- 检查网络连接
- 验证 SerpAPI API Key
- 切换到 DuckDuckGo（免费）

### 问题3：生成的导图内容不够丰富

**可能原因**：
- 搜索结果不够详细
- 主题过于宽泛

**解决方法**：
- 使用更具体的主题
- 手动提供详细内容让 AI 生成

## 扩展建议

### 未来可添加的功能

1. **多语言支持**：支持多种语言的搜索和生成
2. **结果缓存**：缓存常见主题的搜索结果
3. **质量评分**：对生成的导图进行质量评估
4. **样式定制**：支持不同的导图布局和样式
5. **批量生成**：一次性生成多个相关主题的导图

## 更新日志

### v1.0.0 (2025-11-26)
- ✨ 新增智能生成思维导图功能
- ✅ 集成网络搜索能力
- ✅ 自动判断是否需要搜索
- ✅ 支持主题式和内容式生成
- ✅ 优化 system prompt 指导 AI 工作流程

---

现在你的思维导图助手更智能了！🎉 它可以自动搜索资料并生成高质量的思维导图。

